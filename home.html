<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>TRIBERIUM â€” SocialFi</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ===============================
   DESIGN SYSTEM
================================= */
:root{
  --primary:#7b2cbf;
  --primary-dark:#5a189a;
  --bg:#f6f2ff;
  --card:#ffffff;
  --text:#111;
  --muted:#6b7280;
  --border:rgba(123,44,191,0.15);
}
[data-theme="dark"]{
  --bg:#0f0f14;
  --card:#1a1a22;
  --text:#f5f5f7;
  --muted:#9ca3af;
  --border:rgba(255,255,255,0.08);
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ===============================
   HEADER
================================= */
.header{
  position:sticky;
  top:0;
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:100;
}
.logo{
  font-weight:800;
  font-size:1.4rem;
  color:var(--primary);
}
.wallet{
  font-size:0.85rem;
  color:var(--primary);
}

/* ===============================
   FEED
================================= */
.page{
  padding:20px;
  padding-bottom:100px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
.post-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.post-user{
  font-weight:600;
}
.post-content{
  margin:12px 0;
}
.post-actions{
  display:flex;
  gap:12px;
}
.action{
  cursor:pointer;
  font-size:0.85rem;
  color:var(--primary);
  font-weight:600;
}
.action:hover{
  opacity:0.7;
}
</style>
</head>

<body>

<header class="header">
  <div class="logo">TRIBERIUM</div>
  <div class="wallet">TBM: <span id="walletBalance">0.00</span></div>
</header>

<section class="page" id="feed"></section>

<script type="module">

/* =========================================================
   FIREBASE IMPORTS (Modular SDK)
========================================================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth,
  onAuthStateChanged,
  signInAnonymously
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  query,
  orderBy,
  serverTimestamp,
  updateDoc,
  doc,
  increment
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* =========================================================
   FIREBASE CONFIGURATION
========================================================= */
const firebaseConfig = {
  apiKey: "AIzaSyAjX9SLUbKPjldZELBvtQg0K0A-UEDLRIs",
  authDomain: "triberium-mvp.firebaseapp.com",
  projectId: "triberium-mvp",
  storageBucket: "triberium-mvp.firebasestorage.app",
  messagingSenderId: "519861052514",
  appId: "1:519861052514:web:56348e80320066cd311d3b"
};

/* =========================================================
   INITIALIZATION LAYER
========================================================= */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* =========================================================
   AUTHENTICATION LAYER
========================================================= */
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    await signInAnonymously(auth);
  } else {
    console.log("Authenticated:", user.uid);
    loadFeed();
  }
});

/* =========================================================
   DATA ACCESS LAYER
========================================================= */

const feedContainer = document.getElementById("feed");

function loadFeed() {

  const postsRef = collection(db, "posts");
  const q = query(postsRef, orderBy("createdAt", "desc"));

  onSnapshot(q, (snapshot) => {

    feedContainer.innerHTML = "";

    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      renderPost(docSnap.id, post);
    });

  });
}

/* =========================================================
   RENDERING LAYER
========================================================= */

function renderPost(id, post) {

  const card = document.createElement("div");
  card.className = "card";

  card.innerHTML = `
    <div class="post-header">
      <div class="post-user">@${post.user}</div>
      <div>${new Date(post.createdAt?.seconds * 1000).toLocaleString()}</div>
    </div>
    <div class="post-content">${post.content}</div>
    <div class="post-actions">
      <div class="action like">Like (${post.likes || 0})</div>
      <div class="action comment">Comment (${post.comments || 0})</div>
      <div class="action share">Share (${post.shares || 0})</div>
    </div>
  `;

  /* ===============================
     INTERACTION HANDLERS
  ================================= */

  card.querySelector(".like").addEventListener("click", async () => {
    await updateDoc(doc(db, "posts", id), {
      likes: increment(1)
    });
  });

  feedContainer.appendChild(card);
}

/* =========================================================
   POST CREATION (Scalable API)
========================================================= */

async function createPost(user, content) {
  await addDoc(collection(db, "posts"), {
    user,
    content,
    likes: 0,
    comments: 0,
    shares: 0,
    createdAt: serverTimestamp()
  });
}

/* =========================================================
   DEVELOPMENT SEED (Remove in production)
========================================================= */
// createPost("TriberiumCore", "Welcome to TRIBERIUM powered by Firebase.");

</script>

</body>
</html>
